<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plateforme de sélection aléatoire</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    :root {
      color-scheme: light dark;
    }
    body {
      font-family: 'Unbounded', sans-serif;
      min-height: 100vh;
      background-color: #000000;
      color: #FFFFFF;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      position: relative;
      overflow-x: hidden;
    }
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px),
                        linear-gradient(0deg, rgba(255,255,255,0.05) 1px, transparent 1px);
      background-size: 40px 40px;
      opacity: 0.4;
      pointer-events: none;
      animation: gridShift 20s linear infinite;
    }
    @keyframes gridShift {
      from { transform: translateY(0); }
      to { transform: translateY(40px); }
    }
    .card {
      width: min(960px, 100%);
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(56, 189, 248, 0.4);
      border-radius: 32px;
      padding: 3rem;
      position: relative;
      z-index: 1;
      box-shadow: 0 20px 60px rgba(0,0,0,0.8);
      overflow: hidden;
    }
    .card::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(56,189,248,0.2), transparent 40%);
      pointer-events: none;
      z-index: -1;
    }
    h1 {
      font-size: clamp(2.5rem, 6vw, 4.5rem);
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 1rem;
    }
    h2 {
      font-size: clamp(1.5rem, 3vw, 2.5rem);
      font-weight: 600;
      margin-bottom: 1.5rem;
    }
    p {
      color: rgba(255,255,255,0.8);
      font-size: 1.1rem;
    }
    button {
      border: none;
      cursor: pointer;
      font-family: inherit;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.3s ease;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .primary-btn {
      background: #38BDF8;
      color: #000000;
      padding: 1rem 2.5rem;
      border-radius: 999px;
      font-size: 1.1rem;
      box-shadow: 0 15px 35px rgba(56, 189, 248, 0.3);
    }
    .primary-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 20px 35px rgba(56, 189, 248, 0.5);
    }
    .outline-btn {
      background: transparent;
      color: #38BDF8;
      padding: 0.9rem 2rem;
      border-radius: 999px;
      border: 2px solid rgba(56, 189, 248, 0.7);
    }
    .outline-btn:hover {
      transform: translateY(-2px);
      border-color: #38BDF8;
    }
    .outline-btn1{
      display: none;
    }
    .input-group {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }
    .input-group input {
      flex: 1;
      min-width: 240px;
      padding: 1rem 1.2rem;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.05);
      color: #FFFFFF;
      font-size: 1rem;
      transition: border 0.2s ease, box-shadow 0.2s ease;
    }
    .input-group input:focus {
      outline: none;
      border-color: #38BDF8;
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2);
    }
    .sections {
      display: none;
      animation: fadeIn 0.4s ease forwards;
    }
    .sections.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .countdown-display {
      font-size: clamp(3rem, 8vw, 6rem);
      font-weight: 700;
      color: #38BDF8;
    }
    .preloader {
      width: 80px;
      height: 80px;
      border: 6px solid rgba(56, 189, 248, 0.2);
      border-top-color: #38BDF8;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 2rem auto;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 2rem 0;
      background: rgba(255,255,255,0.02);
      border-radius: 24px;
      overflow: hidden;
    }
    th, td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    th {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: rgba(255,255,255,0.7);
    }
    tr:last-child td {
      border-bottom: none;
    }
    .results-table tbody tr {
      transition: background 0.3s ease;
    }
    .results-table tbody tr:hover {
      background: rgba(56, 189, 248, 0.08);
    }
    .explosion {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: visible;
    }
    .particle {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #38BDF8;
      opacity: 0;
      animation: pop 0.8s ease-out forwards;
    }
    @keyframes pop {
      0% { opacity: 1; transform: translate(0,0) scale(1); }
      100% { opacity: 0; transform: translate(var(--x), var(--y)) scale(0); }
    }
    @media (max-width: 640px) {
      .card { padding: 2rem; }
      .input-group { flex-direction: column; }
      .input-group input { min-width: 100%; }
      table { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <div class="card">
    <section id="landing" class="sections active text-center">
      <h1>Plateforme de sélection aléatoire</h1>
      <p>Un tirage équitable, auditable et électrisant grâce à l'algorithme Fisher–Yates.</p>
      <div class="mt-10">
        <button id="startBtn" class="primary-btn text-lg">Démarrer la sélection</button>
      </div>
    </section>

    <section id="formSection" class="sections">
      <h2>Formulaire de candidats</h2>
      <p>Ajoutez chaque profil pour lancer un classement 100% impartial.</p>
      <div id="candidateList"></div>
      <div class="flex flex-wrap gap-4 mt-6">
        <button id="addCandidate" class="outline-btn">+ Ajouter un candidat</button>
        <button id="launchSelection" class="primary-btn">Lancer la sélection</button>
      </div>
    </section>

    <section id="processSection" class="sections text-center">
      <h2>Préparation du tirage</h2>
      <div class="preloader"></div>
      <p class="text-lg">Résultat dans :</p>
      <div class="countdown-display" id="countdown">7</div>
      <p class="text-sm text-gray-300 mt-4">Algorithme Fisher–Yates en cours d'exécution...</p>
      <div id="explosion" class="explosion"></div>
    </section>

    <section id="resultSection" class="sections">
      <h2>Classement final</h2>
      <p>Chaque rang est certifié aléatoire, enregistré et téléchargeable.</p>
      <table class="results-table">
        <thead>
          <tr>
            <th>Rang</th>
            <th>Nom</th>
          </tr>
        </thead>
        <tbody id="resultsBody"></tbody>
      </table>
      <div class="flex flex-wrap gap-4 mt-8">
        <button id="rerunSelection" class="outline-btn outline-btn1">Reprendre la sélection</button>
        <button id="backToForm" class="outline-btn">Retour au formulaire</button>
        <button id="resetApp" class="primary-btn">Démarrer une nouvelle sélection</button>
      </div>
    </section>
  </div>

  <script>
    const sections = {
      landing: document.getElementById('landing'),
      form: document.getElementById('formSection'),
      process: document.getElementById('processSection'),
      result: document.getElementById('resultSection')
    };

    const candidateList = document.getElementById('candidateList');
    const addCandidateBtn = document.getElementById('addCandidate');
    const launchSelectionBtn = document.getElementById('launchSelection');
    const startBtn = document.getElementById('startBtn');
    const rerunBtn = document.getElementById('rerunSelection');
    const backToFormBtn = document.getElementById('backToForm');
    const resetBtn = document.getElementById('resetApp');
    const countdownDisplay = document.getElementById('countdown');
    const resultsBody = document.getElementById('resultsBody');
    const explosionContainer = document.getElementById('explosion');

    let lastCandidates = [];
    let countdownInterval = null;

    function showSection(target) {
      Object.values(sections).forEach(section => section.classList.remove('active'));
      target.classList.add('active');
    }

    function createInput(value = '') {
      const wrapper = document.createElement('div');
      wrapper.className = 'input-group';
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Nom du candidat';
      input.value = value;
      wrapper.appendChild(input);
      return wrapper;
    }

    function renderInitialInputs() {
      candidateList.innerHTML = '';
      const inputs = lastCandidates.length ? lastCandidates : ['', ''];
      inputs.forEach(val => candidateList.appendChild(createInput(val)));
    }

    function getCandidateNames() {
      const inputs = candidateList.querySelectorAll('input');
      return Array.from(inputs)
        .map(input => input.value.trim())
        .filter(name => name.length > 0);
    }

    function fisherYates(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function startCountdown(candidates) {
      let timeLeft = 7;
      countdownDisplay.textContent = timeLeft;
      showSection(sections.process);
      if (countdownInterval) clearInterval(countdownInterval);
      countdownInterval = setInterval(() => {
        timeLeft--;
        countdownDisplay.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(countdownInterval);
          triggerExplosion();
          setTimeout(() => {
            finalizeSelection(candidates);
          }, 600);
        }
      }, 1000);
    }

    function populateResults(shuffled) {
      resultsBody.innerHTML = '';
      shuffled.forEach((name, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>#${index + 1}</td><td>${name}</td>`;
        resultsBody.appendChild(row);
      });
    }

    function triggerExplosion() {
      explosionContainer.innerHTML = '';
      const particles = 24;
      for (let i = 0; i < particles; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        const angle = (Math.PI * 2 * i) / particles;
        const distance = 120 + Math.random() * 60;
        particle.style.setProperty('--x', `${Math.cos(angle) * distance}px`);
        particle.style.setProperty('--y', `${Math.sin(angle) * distance}px`);
        particle.style.left = '50%';
        particle.style.top = '50%';
        explosionContainer.appendChild(particle);
      }
    }

    function downloadSelectionJSON(selection) {
      const blob = new Blob([JSON.stringify(selection, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `selection_${selection.id_selection}.json`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function finalizeSelection(candidates) {
      const shuffled = fisherYates(candidates);
      populateResults(shuffled);
      const selectionData = {
        id_selection: crypto.randomUUID(),
        date: new Date().toISOString(),
        candidats: shuffled.map((nom, index) => ({ nom, rang: index + 1 }))
      };
      downloadSelectionJSON(selectionData);
      lastCandidates = candidates;
      showSection(sections.result);
    }

    startBtn.addEventListener('click', () => {
      renderInitialInputs();
      showSection(sections.form);
    });

    addCandidateBtn.addEventListener('click', () => {
      candidateList.appendChild(createInput());
    });

    launchSelectionBtn.addEventListener('click', () => {
      const names = getCandidateNames();
      if (names.length < 2) {
        alert('Ajoutez au moins deux candidats avec des noms valides.');
        return;
      }
      startCountdown(names);
    });

    rerunBtn.addEventListener('click', () => {
      if (lastCandidates.length >= 2) {
        startCountdown(lastCandidates);
      }
    });

    backToFormBtn.addEventListener('click', () => {
      lastCandidates = lastCandidates.length ? lastCandidates : getCandidateNames();
      renderInitialInputs();
      showSection(sections.form);
    });

    resetBtn.addEventListener('click', () => {
      lastCandidates = [];
      renderInitialInputs();
      showSection(sections.form);
    });

    window.addEventListener('load', () => {
      renderInitialInputs();
    });
  </script>
</body>
</html>
